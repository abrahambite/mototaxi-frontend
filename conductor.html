<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Conductor - MotoTaxi</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Panel del Conductor</h1>
        <button id="logout">Cerrar Sesión</button>
    </header>

    <section id="viajes-disponibles">
        <h2>Viajes Disponibles</h2>
        <ul id="lista-viajes"></ul>
    </section>

    <script>
        async function cargarViajesDisponibles() {
            try {
                const res = await fetch("https://mototaxi-api-production.up.railway.app/viajes-disponibles");
                const viajes = await res.json();
                const lista = document.getElementById("lista-viajes");
                lista.innerHTML = "";

                viajes.forEach(viaje => {
                    const item = document.createElement("li");
                    item.innerHTML = `
                        <strong>Origen:</strong> ${viaje.origen.lat}, ${viaje.origen.lng}<br>
                        <strong>Destino:</strong> ${viaje.destino.lat}, ${viaje.destino.lng}<br>
                        <button onclick="aceptarViaje(${viaje.id})">Aceptar</button>
                        <hr>
                    `;
                    lista.appendChild(item);
                });
            } catch (err) {
                console.error("Error al cargar viajes:", err);
            }
        }

        async function aceptarViaje(idViaje) {
            try {
                const res = await fetch(`https://mototaxi-api-production.up.railway.app/viajes/${idViaje}`, {
                    method: "PATCH",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ estado: "aceptado", conductor_id: 2 }) // ID conductor fijo para pruebas
                });

                const data = await res.json();
                alert("Viaje aceptado ✅");
                console.log("Viaje actualizado:", data);
                cargarViajesDisponibles();
            } catch (err) {
                console.error("Error al aceptar viaje:", err);
            }
        }

        document.getElementById("logout").addEventListener("click", () => {
            window.location.href = "index.html";
        });

        cargarViajesDisponibles();
    </script>
</body>
</html>
