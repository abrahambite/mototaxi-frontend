<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seguimiento - MotoTaxi</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <img src="img/logo.jpeg" alt="Logo MotoTaxi" style="max-width: 150px; margin: 10px auto; display: block;" />
    <h2>Tu unidad viene en camino 🛵</h2>

    <div id="map" style="width: 100%; height: 400px; margin-bottom: 15px;"></div>

    <div id="choferInfo" style="margin-bottom: 10px;">
      👤 <strong>Chofer:</strong> Cargando...<br>
      🏍️ <strong>Unidad:</strong> Cargando...<br>
      📞 <strong>Contacto:</strong> Cargando...
    </div>

    <button id="cancelarViaje" style="background-color: crimson; color: white; padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer;">
      Cancelar Viaje
    </button>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const viajeId = urlParams.get("viaje");

    async function init() {
      try {
        const res = await fetch(`https://mototaxi-api-production.up.railway.app/viajes`);
        const viajes = await res.json();
        const viaje = viajes.find(v => v.id == viajeId);

        if (!viaje) {
          alert("No se encontró el viaje.");
          return;
        }

        const usuariosRes = await fetch(`https://mototaxi-api-production.up.railway.app/usuarios`);
        const usuarios = await usuariosRes.json();
        const chofer = usuarios.find(u => u.id == viaje.conductor_id);

        // Mostrar datos del conductor
        const choferInfo = document.getElementById("choferInfo");
        choferInfo.innerHTML = `
          👤 <strong>Chofer:</strong> ${chofer?.nombre || "No identificado"}<br>
          🏍️ <strong>Unidad:</strong> ${chofer?.vehiculo || "Sin datos"}<br>
          📞 <strong>Contacto:</strong> ${chofer?.telefono || "N/A"}
        `;

        // Mapa
        const map = new google.maps.Map(document.getElementById("map"), {
          center: viaje.origen,
          zoom: 14
        });

        new google.maps.Marker({
          position: viaje.origen,
          map: map,
          label: "Inicio",
          icon: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
        });

        new google.maps.Marker({
          position: viaje.destino,
          map: map,
          label: "Destino",
          icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
        });

      } catch (error) {
        console.error("Error al cargar el seguimiento:", error);
        alert("Ocurrió un error al cargar el seguimiento.");
      }
    }

    init();

    document.getElementById("cancelarViaje").addEventListener("click", () => {
      alert("El viaje ha sido cancelado.");
      window.location.href = "solicitud-viaje.html";
    });
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCdREUrEpKTCtslj4zw-2BDE_LO4wVABnI&callback=init">
  </script>
</body>
</html>
